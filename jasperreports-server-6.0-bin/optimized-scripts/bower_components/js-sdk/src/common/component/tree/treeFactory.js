define(["require","./Tree","jquery","json3","./TreeDataLayer","./plugin/TooltipPlugin","common/enum/repositoryResourceTypes","text!./template/repositoryFoldersTreeLevelTemplate.htm","bundle!CommonBundle","jrs.configs"],function(e){function r(e){var r=2;return e.isWritable&&(r=4|r),e.isRemovable&&(r=16|r),e.isAdministrable&&(r=1),r}var o=e("./Tree"),t=e("jquery"),i=e("json3"),l=e("./TreeDataLayer"),s=e("./plugin/TooltipPlugin"),n=e("common/enum/repositoryResourceTypes"),a=e("text!./template/repositoryFoldersTreeLevelTemplate.htm"),u=e("bundle!CommonBundle"),c=e("jrs.configs"),d={folderTreeProcessor:{processItem:function(e){return e._node=!0,e._readonly=!(1==e.value.permissionMask||4&e.value.permissionMask),e}},filterPublicFolderProcessor:{processItem:function(e){return e.value.uri!==c.publicFolderUri&&e.value.uri!==c.tempFolderUri?e:void 0}},i18n:{processItem:function(e){return e.i18n=u,e}}};return{repositoryFoldersTree:function(e){return o.use(s).create().instance({additionalCssClasses:"folders",dataUriTemplate:e.contextPath+"/rest_v2/resources?{{= id != '@fakeRoot' ? 'folderUri=' + id : ''}}&recursive=false&type="+n.FOLDER+"&offset={{= offset }}&limit={{= limit }}",levelDataId:"uri",itemsTemplate:a,collapsed:!0,lazyLoad:!0,rootless:!0,selection:{allowed:!0,multiple:!1},customDataLayers:{"/":_.extend(new l({dataUriTemplate:e.contextPath+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:_.chain(d).omit("filterPublicFolderProcessor").values().value(),getDataArray:function(e){e=i.parse(t(e).text());var o=_.find(e.children,function(e){return"/public"===e.uri});return[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",permissionMask:r(e.extra),_links:{content:"@fakeContentLink"}},{id:"/public",label:o.label,uri:"/public",resourceType:"folder",permissionMask:r(o.extra),_links:{content:"@fakeContentLink"}}]}}),{accept:"text/html",dataType:"text"})},processors:[d.i18n,d.folderTreeProcessor,d.filterPublicFolderProcessor],getDataArray:function(e){return e?e[n.RESOURCE_LOOKUP]:[]}})}}});